{% extends 'base.html' %}
{% block content %}
<div class="container-main">
  <!-- Resultado del an√°lisis -->
  {% if resultado %}
  <div class="mb-4">
    <h4 style="color: #ffc107; margin-bottom: 1rem;">üìä Resultado del an√°lisis</h4>
    
    {% if resultado is string %}
      <!-- Si resultado es string, mostrarlo en pre -->
      <div class="bg-dark p-3 rounded" style="border: 1px solid var(--card-border); max-height: 400px; overflow-y: auto;">
        <pre class="text-light mb-0" style="font-size: 0.85rem;">{{ resultado }}</pre>
      </div>
    {% else %}
      <!-- Si resultado es dict, mostrar an√°lisis formateado -->
      <div class="row">
        <!-- Mods Prohibidos -->
        <div class="col-md-6 mb-3">
          <div class="card p-3" style="background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.05)); border: 1px solid #dc3545;">
            <h5 style="color: #dc3545; margin-bottom: 1rem;">‚ùå Mods Prohibidos</h5>
            {% if resultado.mods_prohibidos %}
              <div style="max-height: 300px; overflow-y: auto;">
                {% for mod in resultado.mods_prohibidos %}
                <div class="mb-2 p-2" style="background: rgba(220, 53, 69, 0.1); border-radius: 4px; border-left: 3px solid #dc3545;">
                  <div style="color: #dc3545; font-weight: 600;">{{ mod.name }}</div>
                  <small style="color: #b8c1ca;">{{ mod.category or 'Sin categor√≠a' }} ‚Ä¢ {{ mod.platform or 'N/A' }}</small>
                </div>
                {% endfor %}
              </div>
              <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #dc3545;">
                <span class="badge bg-danger">Total: {{ resultado.mods_prohibidos|length }}</span>
              </div>
            {% else %}
              <div style="color: #b8c1ca; text-align: center; padding: 2rem;">
                ‚úì Sin mods prohibidos detectados
              </div>
            {% endif %}
          </div>
        </div>

        <!-- Mods Permitidos -->
        <div class="col-md-6 mb-3">
          <div class="card p-3" style="background: linear-gradient(135deg, rgba(81, 207, 102, 0.1), rgba(81, 207, 102, 0.05)); border: 1px solid #51cf66;">
            <h5 style="color: #51cf66; margin-bottom: 1rem;">‚úì Mods Permitidos</h5>
            {% if resultado.mods_permitidos %}
              <div style="max-height: 300px; overflow-y: auto;">
                {% for mod in resultado.mods_permitidos %}
                <div class="mb-2 p-2" style="background: rgba(81, 207, 102, 0.1); border-radius: 4px; border-left: 3px solid #51cf66;">
                  <div style="color: #51cf66; font-weight: 600;">{{ mod.name }}</div>
                  <small style="color: #b8c1ca;">{{ mod.category or 'Sin categor√≠a' }} ‚Ä¢ {{ mod.platform or 'N/A' }}</small>
                </div>
                {% endfor %}
              </div>
              <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #51cf66;">
                <span class="badge bg-success">Total: {{ resultado.mods_permitidos|length }}</span>
              </div>
            {% else %}
              <div style="color: #b8c1ca; text-align: center; padding: 2rem;">
                Sin mods permitidos detectados
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Resumen -->
      <div class="alert alert-info mt-3" style="background: rgba(13, 110, 253, 0.1); border-color: #0d6efd; color: #b8d4ff;">
        <strong>üìå Resumen:</strong> 
        Se detectaron <span style="color: #dc3545; font-weight: 600;">{{ resultado.mods_prohibidos|length }}</span> mods prohibidos 
        y <span style="color: #51cf66; font-weight: 600;">{{ resultado.mods_permitidos|length }}</span> mods permitidos.
        <br><small>Total de mods analizados: <strong>{{ resultado.mods_prohibidos|length + resultado.mods_permitidos|length }}</strong></small>
      </div>
    {% endif %}
  </div>
  {% endif %}

  <!-- Botones de acci√≥n -->
  <div class="mb-4">
    <a href="/upload" class="btn btn-primary">üìÅ Subir otro log</a>
    <a href="/paste" class="btn btn-primary">üìã Pegar otro log</a>
    <a href="/" class="btn btn-secondary">üè† Volver al inicio</a>
  </div>

  <!-- Historial de an√°lisis -->
  {% if logs_history %}
  <div class="mt-5">
    <h4 style="color: #ffc107; margin-bottom: 1.5rem;">üìú Historial de an√°lisis</h4>
    
    <div class="table-responsive">
      <table class="table table-dark table-striped table-sm">
        <thead>
          <tr style="border-color: var(--card-border); background: rgba(255, 193, 7, 0.05);">
            <th style="color: #ffc107; width: 150px;">Fecha/Hora</th>
            <th style="color: #ffc107;">Archivo</th>
            <th style="color: #ffc107; width: 100px;">Usuario</th>
            <th style="color: #ffc107; width: 80px;">Prohibidos</th>
            <th style="color: #ffc107; width: 80px;">Permitidos</th>
            <th style="color: #ffc107; width: 80px;">Total</th>
          </tr>
        </thead>
        <tbody>
          {% for item in logs_history %}
          <tr style="border-color: var(--card-border); font-size: 0.9rem;">
            <td>
              <small style="color: #b8c1ca;">{{ item.timestamp }}</small>
            </td>
            <td>
              <span style="color: #ffffff;">{{ item.filename }}</span>
            </td>
            <td>
              <span style="color: #20c997;">{{ item.user }}</span>
            </td>
            <td>
              <span class="badge" style="background: #dc3545;">{{ item.resultado.mods_prohibidos|length if item.resultado.mods_prohibidos else 0 }}</span>
            </td>
            <td>
              <span class="badge" style="background: #51cf66; color: #07210f;">{{ item.resultado.mods_permitidos|length if item.resultado.mods_permitidos else 0 }}</span>
            </td>
            <td>
              <span class="badge" style="background: #0d6efd;">{{ (item.resultado.mods_prohibidos|length if item.resultado.mods_prohibidos else 0) + (item.resultado.mods_permitidos|length if item.resultado.mods_permitidos else 0) }}</span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}

</div>
{% endblock %}
