{% extends 'base.html' %}
{% block content %}
<div class="container-main">
  <h4>Buscar log (archivo)</h4>
  <form action="/upload" method="post" enctype="multipart/form-data">
    <div class="mb-2">
      <input type="file" name="logfile" class="form-control" accept=".log,.txt">
    </div>
    <button class="btn btn-primary">Subir y Analizar</button>
    <a href="/dashboard" class="btn btn-secondary">Volver</a>
  </form>

  <!-- Logs leÃ­dos recientemente -->
  {% if logs_history %}
  <div class="mt-5">
    <h5 style="color: #ffc107; margin-bottom: 1rem;">ðŸ“œ Logs leÃ­dos recientemente</h5>
    <div class="table-responsive">
      <table class="table table-dark table-striped table-sm">
        <thead>
          <tr style="border-color: var(--card-border);">
            <th style="color: #ffc107; width: 140px;">Fecha/Hora</th>
            <th style="color: #ffc107;">Archivo</th>
            <th style="color: #ffc107; width: 90px;">Prohibidos</th>
            <th style="color: #ffc107; width: 90px;">Permitidos</th>
          </tr>
        </thead>
        <tbody>
          {% for item in logs_history[:5] %}
          <tr class="history-row-clickable" data-index="{{ loop.index0 }}" 
              style="border-color: var(--card-border); font-size: 0.85rem; cursor: pointer; transition: background 0.2s;">
            <td>
              <small style="color: #b8c1ca;">{{ item.timestamp }}</small>
            </td>
            <td>
              <span style="color: #ffffff;">{{ item.filename }}</span>
            </td>
            <td>
              <span class="badge" style="background: #dc3545;">{{ item.resultado.mods_prohibidos|length }}</span>
            </td>
            <td>
              <span class="badge" style="background: #51cf66; color: #07210f;">{{ item.resultado.mods_permitidos|length }}</span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <a href="/analysis" class="btn btn-sm btn-info">ðŸ“Š Ver historial completo</a>
  </div>
  {% endif %}
</div>

<script>
  var logsHistory = {{ logs_history|tojson if logs_history else '[]' }};
  
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.history-row-clickable').forEach(row => {
      row.addEventListener('click', function() {
        const index = parseInt(this.dataset.index);
        // Guardar el Ã­ndice en sessionStorage y redirigir a /analysis
        sessionStorage.setItem('selectedLogIndex', index);
        window.location.href = '/analysis';
      });
    });
  });
</script>
{% endblock %}
